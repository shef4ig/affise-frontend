<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affise Analytics Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .filter-dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .filter-button {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
        }
        .filter-button:hover {
            border-color: #9ca3af;
        }
        .filter-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            margin-top: 4px;
        }
        .filter-dropdown:hover .filter-menu {
            display: block;
        }
        .filter-item {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        .filter-item:hover {
            background: #f3f4f6;
        }
        .filter-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        .sortable-header {
            cursor: pointer;
            user-select: none;
        }
        .sortable-header:hover {
            background: #f3f4f6;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
    const [activeTab, setActiveTab] = useState('analytics');

    return (
    <div>
    <div style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', padding: '20px'}}>
    <h1 style={{fontSize: '24px', marginBottom: '10px'}}>üìä Affise Analytics Dashboard</h1>
    <div style={{display: 'flex', gap: '10px', marginTop: '15px'}}>
    <button
    style={{
    padding: '10px 20px',
    background: activeTab === 'analytics' ? 'white' : 'rgba(255,255,255,0.2)',
    color: activeTab === 'analytics' ? '#667eea' : 'white',
    border: 'none',
    borderRadius: '5px',
    cursor: 'pointer',
    fontWeight: activeTab === 'analytics' ? '600' : 'normal'
    }}
    onClick={() => setActiveTab('analytics')}
    >
    –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
    </button>
    </div>
    </div>

    <div style={{maxWidth: '1400px', margin: '0 auto', padding: '20px'}}>
    {activeTab === 'analytics' && <Dashboard2 />}
    </div>
    </div>
    );
    }

    function Dashboard2() {
    const [conversions, setConversions] = useState([]);
    const [offers, setOffers] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');

    const [selectedAdvertisers, setSelectedAdvertisers] = useState([]);
    const [selectedSources, setSelectedSources] = useState([]);
    const [selectedOffers, setSelectedOffers] = useState([]);
    const [dateFrom, setDateFrom] = useState('');
    const [dateTo, setDateTo] = useState('');
    const [minOP, setMinOP] = useState(0);
    const [sortField1, setSortField1] = useState('source');
    const [sortDirection1, setSortDirection1] = useState('asc');
    const [sortField2, setSortField2] = useState('source');
    const [sortDirection2, setSortDirection2] = useState('asc');

    useEffect(() => {
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—á–µ—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toISOString().split('T')[0];
        setDateFrom(yesterdayStr);
        setDateTo(yesterdayStr);
        
        loadData();
    }, []);

    function loadData() {
        setLoading(true);
        setError('');

        Promise.all([
            new Promise((resolve, reject) => {
                Papa.parse('conversions.csv', {
                    download: true,
                    header: true,
                    complete: (results) => resolve(results.data),
                    error: (err) => reject(err)
                });
            }),
            new Promise((resolve, reject) => {
                Papa.parse('offers.csv', {
                    download: true,
                    header: true,
                    complete: (results) => resolve(results.data),
                    error: (err) => reject(err)
                });
            })
        ])
        .then(([convData, offData]) => {
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–π:', convData.length);
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ—Ñ—Ñ–µ—Ä–æ–≤:', offData.length);
            setConversions(convData);
            setOffers(offData);
            setLoading(false);
        })
        .catch(err => {
            console.error('–û—à–∏–±–∫–∞:', err);
            setError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: ' + err.message);
            setLoading(false);
        });
    }

    function parseJSON(str) {
        if (!str) return {};
        try {
            const fixed = str.replace(/'/g, '"');
            return JSON.parse(fixed);
        } catch {
            return {};
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞
    const getSourceCategory = (sourceName) => {
        if (!sourceName || sourceName === '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ') return '–î—Ä—É–≥–∏–µ';
        const name = sourceName.toUpperCase();
        if (name.includes('–í–ö')) return '–í–ö';
        if (name.includes('–û–ï–†')) return '–û–ï–†';
        if (name.includes('–ï–†')) return '–ï–†';
        if (name.includes('–¢–ì')) return '–¢–ì';
        if (name.includes('–Ø–î')) return '–Ø–î';
        if (name.includes('–°–ò–°–¢–ï–ú–ù')) return '–°–∏—Å—Ç–µ–º–Ω—ã–µ';
        return '–î—Ä—É–≥–∏–µ';
    };

    const getFilteredConversions = () => {
        let filtered = conversions.filter(c => c.id);

        if (selectedAdvertisers.length > 0) {
            filtered = filtered.filter(c => {
                const adv = parseJSON(c.advertiser);
                return selectedAdvertisers.includes(adv.title);
            });
        }

        if (selectedSources.length > 0) {
            filtered = filtered.filter(c => {
                const partner = parseJSON(c.partner);
                const manager = partner.manager || {};
                const sourceName = manager.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                const category = getSourceCategory(sourceName);
                return selectedSources.includes(category);
            });
        }

        if (selectedOffers.length > 0) {
            filtered = filtered.filter(c => selectedOffers.includes(c.offer_id));
        }

        if (dateFrom) {
            filtered = filtered.filter(c => {
                const date = c.created_at ? c.created_at.split(' ')[0] : '';
                return date >= dateFrom;
            });
        }

        if (dateTo) {
            filtered = filtered.filter(c => {
                const date = c.created_at ? c.created_at.split(' ')[0] : '';
                return date <= dateTo;
            });
        }

        return filtered;
    };

    const filtered = getFilteredConversions();

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º goal_value –≤–º–µ—Å—Ç–æ goal
    const validGoalValues = ['1', '2', '5', '10'];

    // –î–ª—è –û–ü, –û–†–ë, –ö–æ–Ω–≤–µ—Ä—Å–∏–π - —Ç–æ–ª—å–∫–æ confirmed
    const validFiltered = filtered.filter(c => validGoalValues.includes(String(c.goal_value)) && c.status === 'confirmed');

    const op = validFiltered.reduce((sum, c) => sum + parseFloat(c.earnings || 0), 0);

    const orb = validFiltered.reduce((sum, c) => sum + parseFloat(c.revenue || 0), 0);

    const conversionsCount = validFiltered.filter(c => c.revenue && parseFloat(c.revenue) !== 0).length;

    const activeOffersCount = Object.values(
        validFiltered.reduce((acc, c) => {
                const offerId = c.offer_id;
                if (!acc[offerId]) acc[offerId] = 0;
                acc[offerId] += parseFloat(c.earnings || 0);
                return acc;
            }, {})
    ).filter(v => v >= 5000).length;

    const activePartners = Object.values(
        validFiltered.reduce((acc, c) => {
                const partnerId = c.partner_id;
                if (!acc[partnerId]) acc[partnerId] = 0;
                acc[partnerId] += parseFloat(c.earnings || 0);
                return acc;
            }, {})
    ).filter(v => v >= 5000).length;

    // –î–ª—è –ó–∞–∫–∞–∑–æ–≤ –∏ –î–æ—Ö–æ–¥–∞ - –ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ status
    const orders = filtered
        .filter(c => String(c.goal_value) === '4')
        .reduce((sum, c) => sum + parseFloat(c.sum || 0), 0);

    const income = filtered
        .filter(c => validGoalValues.includes(String(c.goal_value)))
        .reduce((sum, c) => sum + parseFloat(c.sum || 0), 0);

    const romi = orb > 0 ? (income / orb * 100) : 0;

    const uniqueAdvertisers = [...new Set(conversions.map(c => {
        const adv = parseJSON(c.advertiser);
        return adv.title;
    }).filter(Boolean))];

    const uniqueSources = ['–í–ö', '–ï–†', '–û–ï–†', '–¢–ì', '–Ø–î', '–î—Ä—É–≥–∏–µ', '–°–∏—Å—Ç–µ–º–Ω—ã–µ'];

    const uniqueOffers = [...new Set(conversions.map(c => c.offer_id).filter(Boolean))].sort((a, b) => a - b);

    // –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–π
    const daysDiff = dateFrom && dateTo ? 
        Math.max(1, Math.ceil((new Date(dateTo) - new Date(dateFrom)) / (1000 * 60 * 60 * 24))) : 1;

    // –¢–∞–±–ª–∏—Ü–∞ 1: –û–ü –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
    const sourceStats = {};
    validFiltered.forEach(c => {
        const partner = parseJSON(c.partner);
        const manager = partner.manager || {};
        const sourceName = manager.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        const category = getSourceCategory(sourceName);
        
        if (!sourceStats[category]) {
            sourceStats[category] = { op: 0 };
        }
        sourceStats[category].op += parseFloat(c.earnings || 0);
    });

    const sourceOrder = ['–í–ö', '–ï–†', '–û–ï–†', '–¢–ì', '–Ø–î', '–î—Ä—É–≥–∏–µ', '–°–∏—Å—Ç–µ–º–Ω—ã–µ'];
    let sourceTableData = sourceOrder.map(source => ({
        source,
        op: sourceStats[source]?.op || 0,
        opPerDay: (sourceStats[source]?.op || 0) / daysDiff
    }));

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã 1
    sourceTableData.sort((a, b) => {
        let valA = a[sortField1];
        let valB = b[sortField1];
        if (sortField1 === 'source') {
            return sortDirection1 === 'asc' ? 
                sourceOrder.indexOf(valA) - sourceOrder.indexOf(valB) : 
                sourceOrder.indexOf(valB) - sourceOrder.indexOf(valA);
        }
        return sortDirection1 === 'asc' ? valA - valB : valB - valA;
    });

    // –¢–∞–±–ª–∏—Ü–∞ 2: –ê–∫—Ç–∏–≤–Ω—ã–µ –≤–µ–±–º–∞—Å—Ç–µ—Ä—ã –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
    const webmastersBySource = {};
    validFiltered.forEach(c => {
        const partner = parseJSON(c.partner);
        const manager = partner.manager || {};
        const sourceName = manager.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        const category = getSourceCategory(sourceName);
        const partnerId = c.partner_id;
        
        if (!webmastersBySource[category]) {
            webmastersBySource[category] = {};
        }
        if (!webmastersBySource[category][partnerId]) {
            webmastersBySource[category][partnerId] = 0;
        }
        webmastersBySource[category][partnerId] += parseFloat(c.earnings || 0);
    });

    let webmasterTableData = sourceOrder.map(source => {
        const partners = webmastersBySource[source] || {};
        const count = Object.values(partners).filter(op => op >= minOP).length;
        return { source, count };
    });

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã 2
    webmasterTableData.sort((a, b) => {
        let valA = a[sortField2];
        let valB = b[sortField2];
        if (sortField2 === 'source') {
            return sortDirection2 === 'asc' ? 
                sourceOrder.indexOf(valA) - sourceOrder.indexOf(valB) : 
                sourceOrder.indexOf(valB) - sourceOrder.indexOf(valA);
        }
        return sortDirection2 === 'asc' ? valA - valB : valB - valA;
    });

    if (loading) {
        return <div className="text-center p-8 text-lg">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ conversions.csv –∏ offers.csv...</div>;
    }

    if (error) {
        return (
            <div className="bg-red-50 border border-red-300 rounded p-6 text-center">
                <div className="text-red-600 font-semibold mb-2">‚ùå {error}</div>
                <div className="text-sm text-gray-600">–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª—ã conversions.csv –∏ offers.csv –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ —á—Ç–æ –∏ dashboard.html</div>
            </div>
        );
    }

    return (
        <div>
            <h2 className="text-2xl font-bold mb-6">Dashboard 2 - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">–û–ü</div>
                    <div className="text-2xl font-bold">{op.toFixed(2)}</div>
                </div>
                <div className="bg-gradient-to-br from-green-500 to-green-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">–û–†–ë</div>
                    <div className="text-2xl font-bold">{orb.toFixed(2)}</div>
                </div>
                <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">–ö–æ–Ω–≤–µ—Ä—Å–∏–∏</div>
                    <div className="text-2xl font-bold">{conversionsCount}</div>
                </div>
                <div className="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">ROMI</div>
                    <div className="text-2xl font-bold">{romi.toFixed(2)}%</div>
                </div>
                <div className="bg-gradient-to-br from-pink-500 to-pink-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">–ê–∫—Ç–∏–≤–Ω—ã–µ –æ—Ñ—Ñ–µ—Ä—ã</div>
                    <div className="text-2xl font-bold">{activeOffersCount}</div>
                </div>
                <div className="bg-gradient-to-br from-indigo-500 to-indigo-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä—Ç–Ω—ë—Ä—ã</div>
                    <div className="text-2xl font-bold">{activePartners}</div>
                </div>
                <div className="bg-gradient-to-br from-teal-500 to-teal-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">–ó–∞–∫–∞–∑—ã</div>
                    <div className="text-2xl font-bold">{orders.toFixed(2)}</div>
                </div>
                <div className="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white p-4 rounded-lg shadow">
                    <div className="text-sm opacity-90">–î–æ—Ö–æ–¥</div>
                    <div className="text-2xl font-bold">{income.toFixed(2)}</div>
                </div>
            </div>

            <div className="bg-white rounded-lg shadow p-4 mb-6">
                <h3 className="font-semibold mb-3">–§–∏–ª—å—Ç—Ä—ã</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3">
                    <div>
                        <label className="block text-sm mb-1">–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—å ({uniqueAdvertisers.length})</label>
                        <div className="filter-dropdown">
                            <button className="filter-button">
                                {selectedAdvertisers.length === 0 ? '–í—Å–µ' : `–í—ã–±—Ä–∞–Ω–æ: ${selectedAdvertisers.length}`}
                            </button>
                            <div className="filter-menu">
                                <div className="filter-item" onClick={() => setSelectedAdvertisers([])}>
                                    <input 
                                        type="checkbox" 
                                        className="filter-checkbox"
                                        checked={selectedAdvertisers.length === 0}
                                        readOnly
                                    />
                                    <span>–í—Å–µ</span>
                                </div>
                                {uniqueAdvertisers.map(a => (
                                    <div key={a} className="filter-item" onClick={() => {
                                        if (selectedAdvertisers.includes(a)) {
                                            setSelectedAdvertisers(selectedAdvertisers.filter(x => x !== a));
                                        } else {
                                            setSelectedAdvertisers([...selectedAdvertisers, a]);
                                        }
                                    }}>
                                        <input 
                                            type="checkbox" 
                                            className="filter-checkbox"
                                            checked={selectedAdvertisers.includes(a)}
                                            readOnly
                                        />
                                        <span>{a}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm mb-1">–ò—Å—Ç–æ—á–Ω–∏–∫ ({uniqueSources.length})</label>
                        <div className="filter-dropdown">
                            <button className="filter-button">
                                {selectedSources.length === 0 ? '–í—Å–µ' : `–í—ã–±—Ä–∞–Ω–æ: ${selectedSources.length}`}
                            </button>
                            <div className="filter-menu">
                                <div className="filter-item" onClick={() => setSelectedSources([])}>
                                    <input 
                                        type="checkbox" 
                                        className="filter-checkbox"
                                        checked={selectedSources.length === 0}
                                        readOnly
                                    />
                                    <span>–í—Å–µ</span>
                                </div>
                                {uniqueSources.map(s => (
                                    <div key={s} className="filter-item" onClick={() => {
                                        if (selectedSources.includes(s)) {
                                            setSelectedSources(selectedSources.filter(x => x !== s));
                                        } else {
                                            setSelectedSources([...selectedSources, s]);
                                        }
                                    }}>
                                        <input 
                                            type="checkbox" 
                                            className="filter-checkbox"
                                            checked={selectedSources.includes(s)}
                                            readOnly
                                        />
                                        <span>{s}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm mb-1">–û—Ñ—Ñ–µ—Ä ({uniqueOffers.length})</label>
                        <div className="filter-dropdown">
                            <button className="filter-button">
                                {selectedOffers.length === 0 ? '–í—Å–µ' : `–í—ã–±—Ä–∞–Ω–æ: ${selectedOffers.length}`}
                            </button>
                            <div className="filter-menu">
                                <div className="filter-item" onClick={() => setSelectedOffers([])}>
                                    <input 
                                        type="checkbox" 
                                        className="filter-checkbox"
                                        checked={selectedOffers.length === 0}
                                        readOnly
                                    />
                                    <span>–í—Å–µ</span>
                                </div>
                                {uniqueOffers.map(o => (
                                    <div key={o} className="filter-item" onClick={() => {
                                        if (selectedOffers.includes(o)) {
                                            setSelectedOffers(selectedOffers.filter(x => x !== o));
                                        } else {
                                            setSelectedOffers([...selectedOffers, o]);
                                        }
                                    }}>
                                        <input 
                                            type="checkbox" 
                                            className="filter-checkbox"
                                            checked={selectedOffers.includes(o)}
                                            readOnly
                                        />
                                        <span>{o}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    <div>
                        <label className="block text-sm mb-1">–î–∞—Ç–∞ –æ—Ç</label>
                        <input
                            type="date"
                            className="w-full border rounded p-2"
                            value={dateFrom}
                            onChange={(e) => setDateFrom(e.target.value)}
                        />
                    </div>
                    <div>
                        <label className="block text-sm mb-1">–î–∞—Ç–∞ –¥–æ</label>
                        <input
                            type="date"
                            className="w-full border rounded p-2"
                            value={dateTo}
                            onChange={(e) => setDateTo(e.target.value)}
                        />
                    </div>
                </div>
            </div>

            <div className="bg-white rounded-lg shadow p-4 mb-6">
                <h3 className="font-semibold mb-3">–û–ü –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º</h3>
                <div className="text-sm text-gray-600 mb-2">–ü–µ—Ä–∏–æ–¥: {daysDiff} {daysDiff === 1 ? '–¥–µ–Ω—å' : daysDiff < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π'}</div>
                <table className="w-full text-sm">
                    <thead>
                        <tr className="border-b">
                            <th className="text-left py-2 px-3 sortable-header" onClick={() => {
                                if (sortField1 === 'source') {
                                    setSortDirection1(sortDirection1 === 'asc' ? 'desc' : 'asc');
                                } else {
                                    setSortField1('source');
                                    setSortDirection1('asc');
                                }
                            }}>
                                –ò—Å—Ç–æ—á–Ω–∏–∫ {sortField1 === 'source' && (sortDirection1 === 'asc' ? '‚Üë' : '‚Üì')}
                            </th>
                            <th className="text-right py-2 px-3 sortable-header" onClick={() => {
                                if (sortField1 === 'op') {
                                    setSortDirection1(sortDirection1 === 'asc' ? 'desc' : 'asc');
                                } else {
                                    setSortField1('op');
                                    setSortDirection1('desc');
                                }
                            }}>
                                –û–ü {sortField1 === 'op' && (sortDirection1 === 'asc' ? '‚Üë' : '‚Üì')}
                            </th>
                            <th className="text-right py-2 px-3 sortable-header" onClick={() => {
                                if (sortField1 === 'opPerDay') {
                                    setSortDirection1(sortDirection1 === 'asc' ? 'desc' : 'asc');
                                } else {
                                    setSortField1('opPerDay');
                                    setSortDirection1('desc');
                                }
                            }}>
                                –û–ü –≤ –î–µ–Ω—å {sortField1 === 'opPerDay' && (sortDirection1 === 'asc' ? '‚Üë' : '‚Üì')}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {sourceTableData.map(row => (
                            <tr key={row.source} className="border-b hover:bg-gray-50">
                                <td className="py-2 px-3">{row.source}</td>
                                <td className="text-right py-2 px-3">{row.op.toFixed(2)}</td>
                                <td className="text-right py-2 px-3">{row.opPerDay.toFixed(2)}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            <div className="bg-white rounded-lg shadow p-4 mb-6">
                <div className="flex items-center justify-between mb-3">
                    <h3 className="font-semibold">–ê–∫—Ç–∏–≤–Ω—ã–µ –≤–µ–±–º–∞—Å—Ç–µ—Ä—ã –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º</h3>
                    <div className="flex items-center gap-2">
                        <label className="text-sm">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –û–ü:</label>
                        <input
                            type="number"
                            className="border rounded px-3 py-1 w-32 text-sm"
                            value={minOP}
                            onChange={(e) => setMinOP(parseFloat(e.target.value) || 0)}
                            placeholder="0"
                        />
                    </div>
                </div>
                <table className="w-full text-sm">
                    <thead>
                        <tr className="border-b">
                            <th className="text-left py-2 px-3 sortable-header" onClick={() => {
                                if (sortField2 === 'source') {
                                    setSortDirection2(sortDirection2 === 'asc' ? 'desc' : 'asc');
                                } else {
                                    setSortField2('source');
                                    setSortDirection2('asc');
                                }
                            }}>
                                –ò—Å—Ç–æ—á–Ω–∏–∫ {sortField2 === 'source' && (sortDirection2 === 'asc' ? '‚Üë' : '‚Üì')}
                            </th>
                            <th className="text-right py-2 px-3 sortable-header" onClick={() => {
                                if (sortField2 === 'count') {
                                    setSortDirection2(sortDirection2 === 'asc' ? 'desc' : 'asc');
                                } else {
                                    setSortField2('count');
                                    setSortDirection2('desc');
                                }
                            }}>
                                –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ–±–º–∞—Å—Ç–µ—Ä–æ–≤ {sortField2 === 'count' && (sortDirection2 === 'asc' ? '‚Üë' : '‚Üì')}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {webmasterTableData.map(row => (
                            <tr key={row.source} className="border-b hover:bg-gray-50">
                                <td className="py-2 px-3">{row.source}</td>
                                <td className="text-right py-2 px-3">{row.count}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>

            <div className="bg-white rounded-lg shadow p-4">
                <h3 className="font-semibold mb-3">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                <div className="text-sm text-gray-600 space-y-1">
                    <div>‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–π: <strong>{conversions.length}</strong></div>
                    <div>‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –æ—Ñ—Ñ–µ—Ä–æ–≤: <strong>{offers.length}</strong></div>
                    <div>üìä –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –∫–æ–Ω–≤–µ—Ä—Å–∏–π: <strong>{filtered.length}</strong></div>
                </div>
            </div>
        </div>
    );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>